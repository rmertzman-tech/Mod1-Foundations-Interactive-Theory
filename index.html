<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Module 1: Framework Foundations - Ethical Design</title>

  <!-- React 18 UMD -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>

  <!-- Babel Standalone (for inline JSX in this demo build) -->
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <!-- Tailwind CDN (note: we avoid runtime-generated class names) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .gradient-bg { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
    .progress-bar { transition: width 0.3s ease; }
    .fade-in { animation: fadeIn 0.5s ease-in; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(10px);} to { opacity: 1; transform: translateY(0);} }
    .mastery-badge { display: inline-flex; align-items: center; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600; }
    .mastery-novice { background: #fee2e2; color: #991b1b; }
    .mastery-developing { background: #fef3c7; color: #92400e; }
    .mastery-proficient { background: #d1fae5; color: #065f46; }
    .mastery-mastered { background: #dbeafe; color: #1e40af; }
    @media print {
      body * { visibility: hidden; }
      #printable-document, #printable-document * { visibility: visible; }
      #printable-document { position: absolute; left: 0; top: 0; width: 100%; }
    }
  </style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>

  <!-- App Code -->
  <script type="text/babel" data-presets="env,react">
    const { useState, useEffect } = React;

    // ---------------------------
    // Utility Functions
    // ---------------------------
    const generateSessionId = () => {
      const date = new Date();
      const dateStr = date.toISOString().slice(0,10).replace(/-/g, '');
      const timeStr = date.toTimeString().slice(0,5).replace(/:/g, '');
      const random = Math.random().toString(36).substring(2, 8).toUpperCase();
      return `M1-${dateStr}-${timeStr}-${random}`;
    };

    const calculateMastery = (accuracy) => {
      if (accuracy >= 90) return 'mastered';
      if (accuracy >= 80) return 'proficient';
      if (accuracy >= 60) return 'developing';
      return 'novice';
    };

    const getMasteryLabel = (level) => {
      const labels = {
        mastered: '‚≠ê Mastered',
        proficient: '‚úì Proficient',
        developing: 'üîÑ Developing',
        novice: '‚≠ï Novice',
        'not-started': '‚≠ï Not Started'
      };
      return labels[level] || labels['not-started'];
    };

    // Avoid runtime Tailwind class generation; map colors to explicit classes
    const colorClasses = {
      blue:  { border: 'border-blue-500',  bg: 'bg-blue-50',  text: 'text-blue-600'  },
      green: { border: 'border-green-500', bg: 'bg-green-50', text: 'text-green-600' },
      purple:{ border: 'border-purple-500',bg: 'bg-purple-50',text: 'text-purple-600'},
      red:   { border: 'border-red-500',   bg: 'bg-red-50',   text: 'text-red-600'   }
    };

    // ---------------------------
    // Practice Scenarios Data
    // ---------------------------
    const PRACTICE_SCENARIOS = {
      levels: [
        {
          id: 'ls1',
          question: "Healthcare workers at a hospital are showing reduced compassion and empathy with patients. Investigation reveals chronic understaffing, 12-hour shifts with no breaks, and impossible workloads. What level is this problem?",
          options: [
            { id: 'A', text: "Capability gap‚Äîthey never learned empathy skills", correct: false },
            { id: 'B', text: "Capacity suppression‚Äîchronic stress is preventing empathy expression", correct: true },
            { id: 'C', text: "Constructor failure‚Äîempathy practices don't persist", correct: false },
            { id: 'D', text: "Meta-constructor issue‚Äîthe system can't improve itself", correct: false }
          ],
          explanation: "Correct answer: B. These are healthcare workers who entered the field specifically because of their compassion. They have the capacity for empathy‚Äîchronic stress, impossible workloads, and moral injury are suppressing this capacity. The intervention should focus on context redesign (reduce workload, restore breaks, build support systems), not training."
        },
        {
          id: 'ls2',
          question: "A company implemented an ethics training program teaching values like 'fairness' and 'respect.' Employees found it inspiring, but three months later, nothing changed. People still don't know HOW to apply these principles in practice. What level is this problem?",
          options: [
            { id: 'A', text: "Capacity suppression‚Äîcontext prevents ethical behavior", correct: false },
            { id: 'B', text: "Capability gap‚Äîlack of clear specifications and reliable methods", correct: true },
            { id: 'C', text: "Constructor failure‚Äîpractices don't persist", correct: false },
            { id: 'D', text: "Meta-constructor issue‚Äîcan't adapt to feedback", correct: false }
          ],
          explanation: "Correct answer: B. This is a capability gap. Employees want to be ethical (capacity exists) but lack clear specifications: 'Be fair' doesn't tell you HOW to choose between qualified candidates. They need concrete protocols, decision criteria, and practiced skills‚Äînot more inspiring talks about values."
        },
        {
          id: 'ls3',
          question: "A startup's ethical culture worked beautifully under the founder, who personally modeled good behavior and resolved ethical dilemmas. After she left, the culture collapsed‚Äîno one knew how to maintain it. What level is this problem?",
          options: [
            { id: 'A', text: "Capacity suppression‚Äînew leaders lack ethical capacity", correct: false },
            { id: 'B', text: "Capability gap‚Äînew leaders need training", correct: false },
            { id: 'C', text: "Constructor failure‚Äîethical practices weren't institutionalized", correct: true },
            { id: 'D', text: "Meta-constructor issue‚Äîcan't improve practices", correct: false }
          ],
          explanation: "Correct answer: C. This is constructor failure. The ethical practices worked but lived entirely in the founder's head. They weren't encoded in persistent structures (documented frameworks, training systems, rituals, norms) that could survive personnel changes. Solution: institutionalization, not finding another charismatic founder."
        },
        {
          id: 'ls4',
          question: "A school district has a zero-tolerance discipline policy that causes clear harm (suspending victims who defend themselves, disproportionate impact on disabled students). Everyone knows it's broken, but there's no mechanism to review or revise it. What level is this problem?",
          options: [
            { id: 'A', text: "Capacity suppression‚Äîpeople don't care about fairness", correct: false },
            { id: 'B', text: "Capability gap‚Äîadministrators need better training", correct: false },
            { id: 'C', text: "Constructor failure‚Äîpolicy isn't working as designed", correct: false },
            { id: 'D', text: "Meta-constructor absence‚Äîsystem can't examine and improve itself", correct: true }
          ],
          explanation: "Correct answer: D. This is meta-constructor absence. The system lacks the capacity to learn from mistakes and adapt. No review mechanisms, no revision authority, no feedback channels. Even with evidence of harm, there's no way to fix it. Solution: build learning systems (review processes, sunset clauses, challenge channels, stakeholder input)."
        },
        {
          id: 'ls5',
          question: "A university's honor code worked for years, but now 40% of students are cheating. Investigation reveals: students are overwhelmed (taking 18+ credits while working 20+ hours), many lack study skills, and a 'everyone does it' culture has developed. What level is this problem?",
          options: [
            { id: 'A', text: "Capacity suppression only‚Äîjust reduce stress", correct: false },
            { id: 'B', text: "Constructor failure only‚Äîjust rebuild honor culture", correct: false },
            { id: 'C', text: "Multi-level problem requiring integrated intervention", correct: true },
            { id: 'D', text: "Capability gap only‚Äîjust teach study skills", correct: false }
          ],
          explanation: "Correct answer: C. This requires multi-level intervention: PRIMARY - capacity suppression (reduce desperate stress through workload caps, financial aid); SECONDARY - capability gaps (teach study skills); TERTIARY - constructor failure (rebuild honor culture). Must address all levels in sequence‚Äîcan't just fix culture while students are desperate."
        }
      ],
      research: [
        {
          id: 'rs1',
          question: "Levin's lab induced functional eyes in frog tissue by altering membrane voltage patterns, without changing DNA. This demonstrates:",
          options: [
            { id: 'A', text: "Genetic mutations are required for new structures", correct: false },
            { id: 'B', text: "Bioelectric context can unlock latent cellular capacities", correct: true },
            { id: 'C', text: "Random chance determines tissue outcomes", correct: false },
            { id: 'D', text: "Only normal eye locations can form functional eyes", correct: false }
          ],
          explanation: "Correct answer: B. This shows that cells have goal-directed competencies (capacity to form eyes) that are context-gated. The bioelectric pattern acts as a control layer‚Äîwrite the right 'voltage software' and cells coordinate to build an eye, even in locations that never normally do so. Same genome, different context, different outcomes."
        },
        {
          id: 'rs2',
          question: "Sapolsky's 'pacific troop' of baboons developed low-aggression culture after aggressive males died from TB. This culture persisted as new males joined. This demonstrates:",
          options: [
            { id: 'A', text: "Genetic changes from natural selection", correct: false },
            { id: 'B', text: "Culture as a constructor that persists across membership changes", correct: true },
            { id: 'C', text: "Temporary behavioral changes that fade", correct: false },
            { id: 'D', text: "Hierarchy is inevitable in primates", correct: false }
          ],
          explanation: "Correct answer: B. The pacific troop shows culture functioning as a constructor‚Äîgroup-level norms that persist independent of specific individuals. New males joining the troop were socialized into low-aggression patterns, proving that social structures can create stable, self-perpetuating patterns without genetic changes."
        },
        {
          id: 'rs3',
          question: "Graeber & Wengrow's research on Indus Valley cities showed sophisticated coordination (standardized measures, public infrastructure) without evidence of kings or centralized coercion. This challenges the assumption that:",
          options: [
            { id: 'A', text: "Ancient people were primitive", correct: false },
            { id: 'B', text: "Large-scale coordination requires autocratic hierarchy", correct: true },
            { id: 'C', text: "Cities always lack planning", correct: false },
            { id: 'D', text: "Agriculture prevents civilization", correct: false }
          ],
          explanation: "Correct answer: B. Indus Valley cities prove that urban-scale coordination (thousands of people) can work through distributed mechanisms (standardization, public goods) rather than centralized command. This shows alternative constructors for large-scale cooperation exist‚Äîhierarchy isn't the only option."
        }
      ],
      abcd: [
        {
          id: 'as1',
          question: "A policy intervention looks perfect on paper but nobody feels motivated to implement it. Which A-B-C-D principle is missing?",
          options: [
            { id: 'A', text: "Agency‚Äîdistributed goal-direction", correct: false },
            { id: 'B', text: "Beauty/Awe‚Äîsalience and future pull", correct: true },
            { id: 'C', text: "Context‚Äîenvironmental conditions", correct: false },
            { id: 'D', text: "Dynamics‚Äîfeedback loops", correct: false }
          ],
          explanation: "Correct answer: B. Beauty/Awe isn't decorative‚Äîit's functional. Interventions need to be compelling, legible, and create 'future pull' that makes people want to participate. Without salience, even technically correct interventions fail because nobody cares enough to implement them."
        },
        {
          id: 'as2',
          question: "An organization keeps trying to 'fix' employees with training, but the toxic competitive culture created by ranking systems keeps undermining ethical behavior. Which principle is being ignored?",
          options: [
            { id: 'A', text: "Agency‚Äîpeople lack capacity", correct: false },
            { id: 'B', text: "Beauty‚Äîinterventions aren't compelling", correct: false },
            { id: 'C', text: "Context‚Äîenvironmental conditions gate behavior", correct: true },
            { id: 'D', text: "Dynamics‚Äîmissing feedback loops", correct: false }
          ],
          explanation: "Correct answer: C. This is the classic 'context error'‚Äîtrying to change agents when the problem is contextual. Ranking systems create competitive rather than cooperative contexts. Sapolsky showed that 'same' individuals behave completely differently in different social structures. Fix the context (remove rankings, reward collaboration) rather than training individuals."
        }
      ]
    };

    // ---------------------------
    // Framework Reference Data
    // ---------------------------
    const FRAMEWORK_REFERENCE = {
      fourLevels: [
        {
          id: 'capacity',
          title: 'CAPACITY',
          subtitle: 'Latent Potential',
          question: "What's latent but suppressed?",
          icon: 'üíé',
          summary: 'Intrinsic competencies that exist but aren\'t currently expressed due to context',
          keyPoint: 'Context-gated‚Äîrequire specific conditions to activate'
        },
        {
          id: 'capability',
          title: 'CAPABILITY',
          subtitle: 'Reliable Function',
          question: "What's reliably performed?",
          icon: '‚öôÔ∏è',
          summary: 'Operationalized competencies that agents can reliably perform',
          keyPoint: 'Coordination-enabling and consistently available'
        },
        {
          id: 'constructor',
          title: 'CONSTRUCTOR',
          subtitle: 'Persistent Transformation',
          question: "What repeatedly produces outcomes?",
          icon: 'üèóÔ∏è',
          summary: 'Systems that repeatedly produce specific transformations and maintain the ability',
          keyPoint: 'Robust, memory-bearing, persists across perturbations'
        },
        {
          id: 'metaconstructor',
          title: 'META-CONSTRUCTOR',
          subtitle: 'Self-Improvement',
          question: "Can it improve itself?",
          icon: 'üîÑ',
          summary: 'Systems that can examine and modify their own transformation processes',
          keyPoint: 'Self-reflective, self-modifying, coherence-maintaining'
        }
      ],
      abcdPrinciples: [
        { letter: 'A', title: 'Agency', summary: 'Distributed across scales, unlockable by design' },
        { letter: 'B', title: 'Beauty/Awe', summary: 'Makes control layers visible, creates future pull' },
        { letter: 'C', title: 'Context', summary: 'Designable infrastructure that gates capabilities' },
        { letter: 'D', title: 'Dynamics', summary: 'Feedbacks, thresholds, attractors, leverage points' }
      ],
      researchers: [
        { name: 'Michael Levin', focus: 'Bioelectric control & morphogenesis', key: 'Same cells, different outcomes based on voltage context' },
        { name: 'Robert Sapolsky', focus: 'Social stress & physiology', key: 'Social context writes directly to biology and behavior' },
        { name: 'Graeber & Wengrow', focus: 'Institutional design history', key: 'Political forms are chosen and reversible, not evolutionary destiny' }
      ]
    };

    // ---------------------------
    // Main App
    // ---------------------------
    function App() {
      const [studentInfo, setStudentInfo] = useState({ name: '', email: '', course: '' });
      const [hasStarted, setHasStarted] = useState(false);
      const [currentSection, setCurrentSection] = useState('intro');
      const [sessionData, setSessionData] = useState(null);
      const [sectionProgress, setSectionProgress] = useState({});
      const [practiceResults, setPracticeResults] = useState({ levels: {}, research: {}, abcd: {} });
      const [quizResults, setQuizResults] = useState(null);
      const [frameworkExpanded, setFrameworkExpanded] = useState(false);

      // Load saved progress
      useEffect(() => {
        const saved = localStorage.getItem('module1Progress');
        if (saved) {
          const data = JSON.parse(saved);
          if (data.hasStarted) {
            setHasStarted(data.hasStarted);
            setStudentInfo(data.studentInfo || {});
            setCurrentSection(data.currentSection || 'intro');
            setSessionData(data.sessionData || null);
            setSectionProgress(data.sectionProgress || {});
            setPracticeResults(data.practiceResults || { levels: {}, research: {}, abcd: {} });
            setQuizResults(data.quizResults || null);
          }
        }
      }, []);

      // Save progress
      useEffect(() => {
        if (hasStarted) {
          localStorage.setItem('module1Progress', JSON.stringify({
            hasStarted,
            studentInfo,
            currentSection,
            sessionData,
            sectionProgress,
            practiceResults,
            quizResults
          }));
        }
      }, [hasStarted, studentInfo, currentSection, sessionData, sectionProgress, practiceResults, quizResults]);

      // Framework expansion preference
      useEffect(() => {
        const saved = localStorage.getItem('module1FrameworkExpanded');
        if (saved) setFrameworkExpanded(JSON.parse(saved));
      }, []);
      useEffect(() => {
        localStorage.setItem('module1FrameworkExpanded', JSON.stringify(frameworkExpanded));
      }, [frameworkExpanded]);

      const startModule = (info) => {
        const session = {
          sessionId: generateSessionId(),
          startTime: new Date().toISOString(),
          completionTime: null
        };
        setStudentInfo(info);
        setSessionData(session);
        setHasStarted(true);
        setCurrentSection('intro');

        const initialProgress = {};
        ['intro', 'levels', 'research', 'abcd', 'integration', 'assessment'].forEach(section => {
          initialProgress[section] = {
            started: section === 'intro',
            startTime: section === 'intro' ? new Date().toISOString() : null,
            endTime: null,
            timeSpent: 0,
            interactions: 0,
            status: 'not-started'
          };
        });
        initialProgress.intro.status = 'in-progress';
        setSectionProgress(initialProgress);
      };

      // Allow functional updates OR plain patch objects
      const updateSectionProgress = (sectionId, updates) => {
        setSectionProgress(prev => {
          const prevSection = prev[sectionId] || {};
          const patch = (typeof updates === 'function') ? updates(prevSection) : updates;
          return {
            ...prev,
            [sectionId]: {
              ...prevSection,
              ...patch
            }
          };
        });
      };

      const navigateToSection = (sectionId) => {
        // end current
        if (sectionProgress[currentSection]) {
          const startTime = new Date(sectionProgress[currentSection].startTime);
          const now = new Date();
          const timeSpent = Math.round((now - startTime) / 60000);
          updateSectionProgress(currentSection, { endTime: now.toISOString(), timeSpent });
        }
        // start next
        if (sectionProgress[sectionId] && !sectionProgress[sectionId].started) {
          updateSectionProgress(sectionId, { started: true, startTime: new Date().toISOString(), status: 'in-progress' });
        }
        setCurrentSection(sectionId);
      };

      const completeSection = (sectionId, masteryLevel = 'proficient') => {
        const startTime = new Date(sectionProgress[sectionId]?.startTime || Date.now());
        const now = new Date();
        const timeSpent = Math.round((now - startTime) / 60000);
        updateSectionProgress(sectionId, { endTime: now.toISOString(), timeSpent, status: masteryLevel });
      };

      const getSectionStatus = (sectionId) => {
        const progress = sectionProgress[sectionId];
        if (!progress || !progress.started) return 'not-started';
        return progress.status;
      };

      const calculateOverallProgress = () => {
        const sections = Object.keys(sectionProgress);
        if (sections.length === 0) return 0;
        const completedCount = sections.filter(s => {
          const status = sectionProgress[s].status;
          return ['proficient', 'mastered', 'developing'].includes(status);
        }).length;
        return Math.round((completedCount / sections.length) * 100);
      };

      if (!hasStarted) return <WelcomeScreen onStart={startModule} />;

      const sections = [
        { id: 'intro', label: 'Introduction', icon: 'üéØ' },
        { id: 'levels', label: 'Four Levels', icon: 'üìä' },
        { id: 'research', label: 'Research Examples', icon: 'üî¨' },
        { id: 'abcd', label: 'A-B-C-D Framework', icon: 'üß©' },
        { id: 'integration', label: 'Integration', icon: 'üéØ' },
        { id: 'assessment', label: 'Final Assessment', icon: '‚úì' }
      ];

      return (
        <div className="min-h-screen">
          {/* Header */}
          <header className="gradient-bg text-white shadow-lg">
            <div className="max-w-7xl mx-auto px-4 py-6">
              <div className="flex justify-between items-start">
                <div>
                  <h1 className="text-3xl font-bold mb-2">Module 1: Framework Foundations</h1>
                  <p className="text-lg opacity-90">Ethical Design: From Capacities to Coordination</p>
                  <div className="mt-4 bg-white/20 rounded-full h-2 overflow-hidden">
                    <div className="progress-bar bg-white h-full" style={{ width: `${calculateOverallProgress()}%` }}></div>
                  </div>
                  <p className="text-sm mt-2 opacity-80">{calculateOverallProgress()}% Complete</p>
                </div>
                <button
                  onClick={() => {
                    if (window.confirm('‚ö†Ô∏è This will permanently delete ALL your saved progress and start over.\n\nProceed?')) {
                      localStorage.clear();
                      window.location.reload();
                    }
                  }}
                  className="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-4 py-2 rounded-lg font-semibold transition-colors flex items-center space-x-2 whitespace-nowrap text-sm"
                  title="Clear all progress and start over"
                >
                  <span>üîÑ</span><span>Start Over</span>
                </button>
              </div>
            </div>
          </header>

          {/* Navigation */}
          <nav className="bg-white shadow-sm sticky top-0 z-50">
            <div className="max-w-7xl mx-auto px-4">
              <div className="flex overflow-x-auto py-4 space-x-2">
                {sections.map(section => {
                  const status = getSectionStatus(section.id);
                  const isCurrent = currentSection === section.id;
                  return (
                    <button
                      key={section.id}
                      onClick={() => navigateToSection(section.id)}
                      className={`flex items-center space-x-2 px-4 py-2 rounded-lg whitespace-nowrap transition-all ${
                        isCurrent ? 'bg-purple-100 text-purple-700 font-semibold' : 'hover:bg-gray-100'
                      }`}
                    >
                      <span className="text-xl">{section.icon}</span>
                      <span>{section.label}</span>
                      {status === 'mastered' && <span className="text-yellow-500">‚≠ê</span>}
                      {status === 'proficient' && <span className="text-green-500">‚úì</span>}
                      {status === 'developing' && <span className="text-yellow-500">üîÑ</span>}
                    </button>
                  );
                })}
              </div>
            </div>
          </nav>

          {/* Framework Reference Panel */}
          <div className="max-w-7xl mx-auto px-4 pt-4">
            <FrameworkReferencePanel expanded={frameworkExpanded} setExpanded={setFrameworkExpanded} />
          </div>

          {/* Content */}
          <main className="max-w-7xl mx-auto px-4 py-8">
            <div className="fade-in">
              {currentSection === 'intro' && (
                <IntroSection
                  onComplete={() => completeSection('intro')}
                  onNext={() => navigateToSection('levels')}
                />
              )}
              {currentSection === 'levels' && (
                <FourLevelsSection
                  practiceResults={practiceResults.levels}
                  setPracticeResults={(results) => setPracticeResults(prev => ({ ...prev, levels: results }))}
                  onComplete={(mastery) => completeSection('levels', mastery)}
                  onNext={() => navigateToSection('research')}
                  updateProgress={(updates) => updateSectionProgress('levels', updates)}
                />
              )}
              {currentSection === 'research' && (
                <ResearchExamplesSection
                  practiceResults={practiceResults.research}
                  setPracticeResults={(results) => setPracticeResults(prev => ({ ...prev, research: results }))}
                  onComplete={(mastery) => completeSection('research', mastery)}
                  onNext={() => navigateToSection('abcd')}
                  updateProgress={(updates) => updateSectionProgress('research', updates)}
                />
              )}
              {currentSection === 'abcd' && (
                <ABCDSection
                  practiceResults={practiceResults.abcd}
                  setPracticeResults={(results) => setPracticeResults(prev => ({ ...prev, abcd: results }))}
                  onComplete={(mastery) => completeSection('abcd', mastery)}
                  onNext={() => navigateToSection('integration')}
                  updateProgress={(updates) => updateSectionProgress('abcd', updates)}
                />
              )}
              {currentSection === 'integration' && (
                <IntegrationSection
                  onComplete={(mastery) => completeSection('integration', mastery)}
                  onNext={() => navigateToSection('assessment')}
                />
              )}
              {currentSection === 'assessment' && (
                <AssessmentSection
                  quizResults={quizResults}
                  setQuizResults={setQuizResults}
                  onComplete={(results) => {
                    setQuizResults(results);
                    const mastery = calculateMastery(results.percentage);
                    completeSection('assessment', mastery);
                    setSessionData(prev => ({ ...prev, completionTime: new Date().toISOString() }));
                  }}
                  studentInfo={studentInfo}
                  sessionData={sessionData}
                  sectionProgress={sectionProgress}
                  practiceResults={practiceResults}
                />
              )}
            </div>
          </main>
        </div>
      );
    }

    // ---------------------------
    // Framework Reference Panel
    // ---------------------------
    function FrameworkReferencePanel({ expanded, setExpanded }) {
      return (
        <div className="mb-6 border border-gray-300 rounded-lg overflow-hidden bg-white shadow">
          <button
            onClick={() => setExpanded(!expanded)}
            className="w-full px-4 py-3 bg-blue-50 hover:bg-blue-100 transition-colors flex items-center justify-between"
          >
            <div className="flex items-center space-x-2">
              <span className="text-lg">üìö</span>
              <span className="font-semibold text-gray-900">Framework Quick Reference</span>
            </div>
            <span className="text-gray-600">{expanded ? '‚ñº Collapse' : '‚ñ∂ Expand'}</span>
          </button>

          {expanded && (
            <div className="p-6 bg-white border-t border-gray-200">
              <div className="grid md:grid-cols-2 gap-6">
                <div>
                  <h4 className="font-bold text-gray-900 mb-3">The Four Levels</h4>
                  <div className="space-y-2">
                    {FRAMEWORK_REFERENCE.fourLevels.map(level => (
                      <div key={level.id} className="bg-gray-50 p-3 rounded-lg">
                        <div className="flex items-start space-x-2">
                          <span className="text-2xl">{level.icon}</span>
                          <div className="flex-1">
                            <p className="font-semibold text-sm text-gray-900">{level.title}</p>
                            <p className="text-xs text-purple-600 italic">{level.question}</p>
                            <p className="text-xs text-gray-600 mt-1">{level.summary}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                </div>

                <div>
                  <h4 className="font-bold text-gray-900 mb-3">A-B-C-D Principles</h4>
                  <div className="space-y-2 mb-4">
                    {FRAMEWORK_REFERENCE.abcdPrinciples.map(principle => (
                      <div key={principle.letter} className="bg-gray-50 p-3 rounded-lg">
                        <div className="flex items-start space-x-2">
                          <span className="font-bold text-purple-600 text-lg">{principle.letter}</span>
                          <div className="flex-1">
                            <p className="font-semibold text-sm text-gray-900">{principle.title}</p>
                            <p className="text-xs text-gray-600">{principle.summary}</p>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>

                  <h4 className="font-bold text-gray-900 mb-3">Three Research Windows</h4>
                  <div className="space-y-2">
                    {FRAMEWORK_REFERENCE.researchers.map((researcher, idx) => (
                      <div key={idx} className="bg-gray-50 p-3 rounded-lg">
                        <p className="font-semibold text-sm text-gray-900">{researcher.name}</p>
                        <p className="text-xs text-gray-600">{researcher.focus}</p>
                        <p className="text-xs text-purple-600 italic mt-1">"{researcher.key}"</p>
                      </div>
                    ))}
                  </div>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    }

    // ---------------------------
    // Welcome Screen
    // ---------------------------
    function WelcomeScreen({ onStart }) {
      const [formData, setFormData] = useState({ name: '', email: '', course: '' });

      const handleSubmit = (e) => {
        e.preventDefault();
        if (formData.name && formData.email && formData.course) onStart(formData);
      };

      return (
        <div className="min-h-screen gradient-bg py-12 px-4">
          <div className="max-w-4xl mx-auto">
            <div className="bg-white rounded-lg shadow-2xl p-8 mb-6">
              <h1 className="text-4xl font-bold text-gray-900 mb-4">Module 1: Framework Foundations</h1>
              <p className="text-xl text-gray-700 mb-6">Ethical Design: From Capacities to Coordination</p>

              <div className="prose prose-lg max-w-none mb-8">
                <p className="text-gray-700 mb-4">
                  Most ethical problems aren't about bad people or wrong values. They're about
                  <strong> context problems</strong>‚Äîsituations where good people's capacities
                  for ethical behavior are suppressed or never unlocked.
                </p>

                <div className="bg-purple-50 border-l-4 border-purple-500 p-6 my-6">
                  <h3 className="text-xl font-semibold text-purple-900 mb-2">The Core Insight</h3>
                  <p className="text-gray-700">
                    Three research programs‚Äîstudying cells, societies, and everything in between‚Äîhave
                    converged on a profound truth: <strong>agency is distributed across scales and can
                    be reprogrammed by writing to the right control layers.</strong>
                  </p>
                </div>

                <h3 className="text-2xl font-semibold text-gray-900 mb-4">What You'll Learn</h3>
                <div className="grid md:grid-cols-2 gap-4">
                  <div className="bg-blue-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-blue-900 mb-2">üîç Diagnostic Framework</h4>
                    <p className="text-sm text-gray-700">Master the four-level model: capacity, capability, constructor, meta-constructor</p>
                  </div>
                  <div className="bg-green-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-green-900 mb-2">üî¨ Research Grounding</h4>
                    <p className="text-sm text-gray-700">Examples from Levin (biology), Sapolsky (social physiology), Graeber & Wengrow (institutions)</p>
                  </div>
                  <div className="bg-yellow-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-yellow-900 mb-2">üß© A-B-C-D Framework</h4>
                    <p className="text-sm text-gray-700">Agency, Beauty/Awe, Context/Contingency, Dynamics</p>
                  </div>
                  <div className="bg-purple-50 p-4 rounded-lg">
                    <h4 className="font-semibold text-purple-900 mb-2">üí™ Practice & Mastery</h4>
                    <p className="text-sm text-gray-700">Integrated exercises, immediate feedback, comprehensive assessment</p>
                  </div>
                </div>

                <div className="bg-gray-100 p-6 rounded-lg mt-6">
                  <h3 className="text-xl font-semibold text-gray-900 mb-3">Module Features</h3>
                  <ul className="space-y-2 text-gray-700">
                    <li>‚úì <strong>Flexible Navigation:</strong> Explore sections in any order</li>
                    <li>‚úì <strong>Framework Reference:</strong> Always-accessible quick guide</li>
                    <li>‚úì <strong>Practice Throughout:</strong> Learn by doing, not just reading</li>
                    <li>‚úì <strong>Immediate Feedback:</strong> Know instantly if you're on track</li>
                    <li>‚úì <strong>Progress Tracking:</strong> See exactly what you've mastered</li>
                    <li>‚úì <strong>Comprehensive Report:</strong> Detailed completion document for your records</li>
                  </ul>
                </div>
              </div>
            </div>

            <div className="bg-white rounded-lg shadow-2xl p-8">
              <h3 className="text-2xl font-bold text-gray-900 mb-4">Before You Begin</h3>
              <form onSubmit={handleSubmit} className="space-y-4">
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Full Name *</label>
                  <input type="text" required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    value={formData.name} onChange={(e) => setFormData({...formData, name: e.target.value})} placeholder="Enter your full name"/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Email Address *</label>
                  <input type="email" required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    value={formData.email} onChange={(e) => setFormData({...formData, email: e.target.value})} placeholder="your.email@university.edu"/>
                </div>
                <div>
                  <label className="block text-sm font-medium text-gray-700 mb-2">Course/Section *</label>
                  <input type="text" required className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                    value={formData.course} onChange={(e) => setFormData({...formData, course: e.target.value})} placeholder="e.g., PHIL 101 - Section 02"/>
                </div>
                <button type="submit" className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors">
                  Begin Module 1 ‚Üí
                </button>
              </form>
            </div>
          </div>
        </div>
      );
    }

    // ---------------------------
    // Intro Section
    // ---------------------------
    function IntroSection({ onComplete, onNext }) {
      useEffect(() => { onComplete(); }, []);
      return (
        <div className="space-y-6">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">Welcome to Ethical Design</h2>
            <div className="prose prose-lg max-w-none">
              <p className="text-xl text-gray-700 leading-relaxed mb-6">
                Most ethical problems aren't really about bad people or wrong values.
                They're about <strong>context problems</strong>‚Äîsituations where good people's
                capacities for ethical behavior are suppressed or never unlocked.
              </p>

              <div className="bg-purple-50 border-l-4 border-purple-500 p-6 my-6">
                <h3 className="text-xl font-semibold text-purple-900 mb-2">The Core Insight</h3>
                <p className="text-gray-700">
                  Three research programs‚Äîstudying cells, societies, and everything in between‚Äîhave
                  converged on a profound truth: <strong>agency is distributed across scales and can
                  be reprogrammed by writing to the right control layers.</strong>
                </p>
              </div>

              <h3 className="text-2xl font-semibold text-gray-900 mt-8 mb-4">The Four-Level Diagnostic Model</h3>
              <p className="text-gray-700 mb-4">This framework helps you identify <em>where</em> ethical problems originate:</p>
              <div className="space-y-3 mb-6">
                <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                  <p className="font-semibold text-blue-900">üíé CAPACITY - Latent Potential</p>
                  <p className="text-sm text-gray-700">Intrinsic competencies that exist but aren't expressed due to context</p>
                </div>
                <div className="bg-green-50 p-4 rounded-lg border-l-4 border-green-500">
                  <p className="font-semibold text-green-900">‚öôÔ∏è CAPABILITY - Reliable Function</p>
                  <p className="text-sm text-gray-700">Operationalized competencies that enable coordination</p>
                </div>
                <div className="bg-purple-50 p-4 rounded-lg border-l-4 border-purple-500">
                  <p className="font-semibold text-purple-900">üèóÔ∏è CONSTRUCTOR - Persistent Transformation</p>
                  <p className="text-sm text-gray-700">Systems that repeatedly produce outcomes and persist</p>
                </div>
                <div className="bg-red-50 p-4 rounded-lg border-l-4 border-red-500">
                  <p className="font-semibold text-red-900">üîÑ META-CONSTRUCTOR - Self-Improvement</p>
                  <p className="text-sm text-gray-700">Systems that can examine and improve themselves</p>
                </div>
              </div>

              <div className="bg-gray-100 p-6 rounded-lg mt-8">
                <h3 className="text-xl font-semibold text-gray-900 mb-3">Why This Matters for Ethics</h3>
                <p className="text-gray-700 mb-4">
                  Traditional ethics focuses on <em>what</em> we should do and <em>why</em>.
                  This framework adds <strong>how</strong>‚Äîhow to diagnose ethical problems
                  systematically and design contexts that enable ethical behavior.
                </p>
                <p className="text-gray-700">
                  Instead of asking "Who's wrong?" we ask: "What's the system problem, and
                  at what level can we intervene most effectively?"
                </p>
              </div>

              <div className="bg-gradient-to-br from-purple-100 to-purple-50 rounded-lg p-6 mt-6">
                <h3 className="text-xl font-semibold text-purple-900 mb-3">How This Module Works</h3>
                <ul className="space-y-2 text-gray-700">
                  <li>‚úì <strong>Navigate freely</strong> between sections‚Äîno forced sequence</li>
                  <li>‚úì <strong>Reference panel</strong> keeps framework visible while you learn</li>
                  <li>‚úì <strong>Practice scenarios</strong> embedded throughout‚Äîlearn by doing</li>
                  <li>‚úì <strong>Immediate feedback</strong> on every exercise</li>
                  <li>‚úì <strong>Track your mastery</strong> across all concepts</li>
                  <li>‚úì <strong>Comprehensive completion document</strong> at the end</li>
                </ul>
              </div>
            </div>

            <button onClick={onNext} className="mt-8 px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
              Continue to Four Levels ‚Üí
            </button>
          </div>
        </div>
      );
    }

    // ---------------------------
    // Four Levels Section
    // ---------------------------
    function FourLevelsSection({ practiceResults, setPracticeResults, onComplete, onNext, updateProgress }) {
      const [selectedLevel, setSelectedLevel] = useState(null);
      const [currentScenario, setCurrentScenario] = useState(0);
      const [scenarioAnswer, setScenarioAnswer] = useState(null);
      const [showScenarios, setShowScenarios] = useState(false);

      const levels = [
        {
          id: 'capacity',
          title: 'CAPACITY',
          subtitle: 'Latent Potential',
          question: "What's latent but suppressed?",
          color: 'blue',
          description: "Intrinsic competencies that exist but aren't currently expressed due to context.",
          characteristics: [
            'Universal or near-universal in agents',
            'Context-gated‚Äîrequire specific conditions to activate',
            'Often invisible until unlocked',
            'Distributed across scales (cellular, individual, social)'
          ],
          examples: [
            'People have capacity for empathy, but chronic stress suppresses it',
            'Organizations have capacity for transparency, but hierarchical structures prevent expression',
            'Frog cells have capacity to form eyes anywhere‚Äîif voltage pattern is right'
          ],
          icon: 'üíé',
          intervention: 'Context redesign‚Äîchange environmental conditions to liberate suppressed capacity'
        },
        {
          id: 'capability',
          title: 'CAPABILITY',
          subtitle: 'Reliable Function',
          question: "What's reliably performed?",
          color: 'green',
          description: 'Operationalized competencies that agents can reliably perform and that enable coordination.',
          characteristics: [
            'Observable and specifiable',
            'Consistently available, not sporadic',
            'Coordination-enabling',
            'Substrate-independent‚Äîdifferent paths to same function'
          ],
          examples: [
            'Reliable capability for conflict resolution in a trained mediator',
            'Reliable due process in an institutionalized legal system',
            'Tissue reliably forms functional eyes when bioelectric context is right'
          ],
          icon: '‚öôÔ∏è',
          intervention: 'Capability development‚Äîbuild clear specifications, training, and reliable methods'
        },
        {
          id: 'constructor',
          title: 'CONSTRUCTOR',
          subtitle: 'Persistent Transformation',
          question: "What repeatedly produces outcomes?",
          color: 'purple',
          description: 'Systems that repeatedly produce specific transformations and maintain the ability to do so.',
          characteristics: [
            'Repeatable across multiple uses',
            'Robust‚Äîsurvives perturbations',
            'Memory-bearing‚Äîmaintains specifications',
            'Compositional‚Äîcan combine with other constructors'
          ],
          examples: [
            'Constitutional due process that works repeatedly across changing personnel',
            'Planaria regenerating proper body plan after every injury',
            'Cultural norms that persist as group membership changes'
          ],
          icon: 'üèóÔ∏è',
          intervention: 'Institutionalization‚Äîdocument knowledge, create training systems, build organizational rituals'
        },
        {
          id: 'metaconstructor',
          title: 'META-CONSTRUCTOR',
          subtitle: 'Self-Improvement',
          question: "Can it improve itself?",
          color: 'red',
          description: 'Systems that can examine and modify their own transformation processes while maintaining coherence.',
          characteristics: [
            'Self-reflective‚Äîcan observe own functioning',
            'Self-modifying‚Äîcan change own processes',
            'Coherence-maintaining‚Äîchanges preserve identity',
            'Adaptive‚Äîimproves performance over time'
          ],
          examples: [
            'Democratic systems with constitutional amendment processes',
            'Organizations with built-in review and revision mechanisms',
            'Individuals who can examine their ethical frameworks and deliberately improve'
          ],
          icon: 'üîÑ',
          intervention: 'Learning systems‚Äîestablish review mechanisms, sunset clauses, challenge channels, feedback systems'
        }
      ];

      const bumpInteractions = () => {
        updateProgress(prev => ({ interactions: (prev?.interactions || 0) + 1 }));
      };

      const handleLevelClick = (levelId) => {
        setSelectedLevel(selectedLevel === levelId ? null : levelId);
        bumpInteractions();
      };

      const handleStartScenarios = () => {
        setShowScenarios(true);
        setCurrentScenario(0);
        setScenarioAnswer(null);
      };

      const handleScenarioAnswer = (optionId) => {
        setScenarioAnswer(optionId);
        const scenario = PRACTICE_SCENARIOS.levels[currentScenario];
        const correct = scenario.options.find(o => o.id === optionId).correct;
        const newResults = { ...practiceResults, [scenario.id]: { correct, selectedAnswer: optionId } };
        setPracticeResults(newResults);
        bumpInteractions();
      };

      const handleNextScenario = () => {
        if (currentScenario < PRACTICE_SCENARIOS.levels.length - 1) {
          setCurrentScenario(currentScenario + 1);
          setScenarioAnswer(null);
        } else {
          const correct = Object.values(practiceResults).filter(r => r.correct).length;
          const total = PRACTICE_SCENARIOS.levels.length;
          const percentage = (correct / total) * 100;
          const mastery = calculateMastery(percentage);
          onComplete(mastery);
        }
      };

      const calculateProgress = () => {
        const attempted = Object.keys(practiceResults).length;
        const total = PRACTICE_SCENARIOS.levels.length;
        return { attempted, total };
      };

      const progress = calculateProgress();

      return (
        <div className="space-y-8">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">The Four-Level Diagnostic Model</h2>
            <p className="text-lg text-gray-700 mb-8">
              Click each level to explore its definition, characteristics, and examples.
              This progression helps you diagnose where ethical problems originate and where to intervene.
            </p>

            {showScenarios && (
              <div className="mb-6 bg-purple-50 p-4 rounded-lg">
                <div className="flex justify-between items-center mb-2">
                  <span className="font-semibold text-purple-900">Practice Progress: {progress.attempted} / {progress.total}</span>
                  <span className="text-sm text-gray-600">
                    {progress.attempted > 0 &&
                      `${Math.round((Object.values(practiceResults).filter(r => r.correct).length / progress.attempted) * 100)}% Correct`
                    }
                  </span>
                </div>
                <div className="w-full bg-gray-200 rounded-full h-2">
                  <div className="progress-bar bg-purple-600 h-2 rounded-full" style={{ width: `${(progress.attempted / progress.total) * 100}%` }}></div>
                </div>
              </div>
            )}

            {!showScenarios ? (
              <>
                <div className="mb-12 space-y-4">
                  {levels.map((level, index) => {
                    const c = colorClasses[level.color];
                    const isOpen = selectedLevel === level.id;
                    return (
                      <div key={level.id}>
                        <button
                          onClick={() => handleLevelClick(level.id)}
                          className={`w-full text-left p-6 rounded-lg border-2 transition-all ${isOpen ? `${c.border} ${c.bg}` : 'border-gray-200 hover:border-gray-300'}`}
                        >
                          <div className="flex items-center justify-between">
                            <div className="flex items-center space-x-4">
                              <span className="text-4xl">{level.icon}</span>
                              <div>
                                <h3 className="text-2xl font-bold text-gray-900">{level.title}</h3>
                                <p className="text-sm text-gray-600">{level.subtitle}</p>
                                <p className="text-lg text-purple-600 mt-1 italic">{level.question}</p>
                              </div>
                            </div>
                            <span className="text-gray-400">{isOpen ? '‚ñº' : '‚ñ∂'}</span>
                          </div>
                        </button>

                        {isOpen && (
                          <div className="mt-4 p-6 bg-gray-50 rounded-lg space-y-4">
                            <p className="text-lg text-gray-700">{level.description}</p>
                            <div>
                              <h4 className="font-semibold text-gray-900 mb-2">Key Characteristics:</h4>
                              <ul className="list-disc list-inside space-y-1">
                                {level.characteristics.map((char, i) => (<li key={i} className="text-gray-700">{char}</li>))}
                              </ul>
                            </div>
                            <div>
                              <h4 className="font-semibold text-gray-900 mb-2">Examples:</h4>
                              <ul className="space-y-2">
                                {level.examples.map((ex, i) => (
                                  <li key={i} className="text-gray-700 bg-white p-3 rounded border-l-4 border-purple-500">{ex}</li>
                                ))}
                              </ul>
                            </div>
                            <div className="bg-blue-50 p-4 rounded-lg border-l-4 border-blue-500">
                              <h4 className="font-semibold text-blue-900 mb-1">Intervention Approach:</h4>
                              <p className="text-gray-700">{level.intervention}</p>
                            </div>
                          </div>
                        )}

                        {index < levels.length - 1 && (
                          <div className="flex justify-center my-2">
                            <div className="text-3xl text-purple-500">‚Üì</div>
                          </div>
                        )}
                      </div>
                    );
                  })}
                </div>

                <div className="bg-gradient-to-br from-purple-100 to-purple-50 rounded-lg p-6 border-2 border-purple-200">
                  <h3 className="text-2xl font-bold text-purple-900 mb-4">Ready to Practice?</h3>
                  <p className="text-gray-700 mb-4">Test your understanding with {PRACTICE_SCENARIOS.levels.length} practice scenarios.</p>
                  <button onClick={handleStartScenarios} className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                    Start Practice Scenarios ‚Üí
                  </button>
                </div>
              </>
            ) : (
              <div className="bg-white rounded-lg border-2 border-purple-200 p-6">
                <h3 className="text-2xl font-bold text-purple-900 mb-4">Scenario {currentScenario + 1} of {PRACTICE_SCENARIOS.levels.length}</h3>
                {(() => {
                  const scenario = PRACTICE_SCENARIOS.levels[currentScenario];
                  return (
                    <>
                      <p className="text-lg text-gray-800 mb-6 font-medium">{scenario.question}</p>
                      <div className="space-y-3 mb-6">
                        {scenario.options.map(option => {
                          const isSelected = scenarioAnswer === option.id;
                          const isCorrect = option.correct;
                          let cls = 'border-gray-300 hover:bg-gray-50';
                          if (scenarioAnswer !== null) {
                            if (isSelected && isCorrect) cls = 'border-green-500 bg-green-50';
                            else if (isSelected && !isCorrect) cls = 'border-red-500 bg-red-50';
                            else if (isCorrect) cls = 'border-green-500 bg-green-50';
                          }
                          return (
                            <button
                              key={option.id}
                              onClick={() => handleScenarioAnswer(option.id)}
                              disabled={scenarioAnswer !== null}
                              className={`w-full text-left p-4 rounded-lg border-2 transition-all ${cls} ${scenarioAnswer !== null ? 'cursor-default' : 'cursor-pointer'}`}
                            >
                              <div className="flex items-start">
                                <span className="font-bold mr-3">{option.id}.</span>
                                <div className="flex-1">
                                  <p className="text-gray-800">{option.text}</p>
                                  {scenarioAnswer && option.correct && <span className="text-green-600 text-sm mt-1 block">‚úì Correct</span>}
                                  {scenarioAnswer === option.id && !option.correct && <span className="text-red-600 text-sm mt-1 block">‚úó Incorrect</span>}
                                </div>
                              </div>
                            </button>
                          );
                        })}
                      </div>

                      {scenarioAnswer && (
                        <>
                          <div className={`p-4 rounded-lg mb-4 ${practiceResults[scenario.id]?.correct ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'}`}>
                            <p className="font-semibold mb-2">{practiceResults[scenario.id]?.correct ? '‚úì Correct!' : '‚úó Not quite'}</p>
                            <p className="text-gray-700 text-sm">{scenario.explanation}</p>
                          </div>
                          <button onClick={handleNextScenario} className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                            {currentScenario < PRACTICE_SCENARIOS.levels.length - 1 ? 'Next Scenario ‚Üí' : 'Complete Practice ‚Üí'}
                          </button>
                        </>
                      )}
                    </>
                  );
                })()}
              </div>
            )}

            {showScenarios && progress.attempted === progress.total && (
              <div className="mt-6">
                <button onClick={onNext} className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                  Continue to Research Examples ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ---------------------------
    // Research Examples Section
    // ---------------------------
    function ResearchExamplesSection({ practiceResults, setPracticeResults, onComplete, onNext, updateProgress }) {
      const [activeTab, setActiveTab] = useState('levin');
      const [currentScenario, setCurrentScenario] = useState(0);
      const [scenarioAnswer, setScenarioAnswer] = useState(null);
      const [showScenarios, setShowScenarios] = useState(false);

      const researchers = {
        levin: {
          name: 'Michael Levin',
          field: 'Developmental Biology',
          institution: 'Tufts University',
          icon: 'üî¨',
          color: 'blue',
          keyInsight: 'Same cells, different outcomes based on bioelectric context',
          examples: [
            {
              title: 'Voltage-Induced Eyes',
              description: "By altering membrane voltage (Vmem), Levin's lab induced complete, functional eyes in locations that never normally develop eyes.",
              lesson: 'Tissues have goal-directed competence. The bioelectric pattern instructed cells to build an eye without DNA changes.',
              level: 'Shows capacity unlocking through context design'
            }
          ]
        },
        sapolsky: {
          name: 'Robert Sapolsky',
          field: 'Behavioral Biology',
          institution: 'Stanford University',
          icon: 'üêí',
          color: 'green',
          keyInsight: 'Social context writes directly to physiology and behavior',
          examples: [
            {
              title: 'The Pacific Troop',
              description: 'After aggressive males died, remaining troop developed low-aggression culture that persisted as new males joined.',
              lesson: 'Culture is a constructor‚Äîgroup norms persist across membership changes.',
              level: 'Shows constructor-level cultural transmission'
            }
          ]
        },
        graeber: {
          name: 'Graeber & Wengrow',
          field: 'Archaeology',
          institution: 'Multiple',
          icon: 'üèõÔ∏è',
          color: 'purple',
          keyInsight: 'Political forms are chosen and reversible',
          examples: [
            {
              title: 'Cities Without Kings',
              description: 'Indus Valley cities showed sophisticated coordination without centralized coercion.',
              lesson: "Urban scale doesn't require autocracy‚Äîalternative constructors exist.",
              level: 'Shows alternative institutional designs'
            }
          ]
        }
      };

      const bumpInteractions = () => updateProgress(prev => ({ interactions: (prev?.interactions || 0) + 1 }));

      const handleStartScenarios = () => {
        setShowScenarios(true);
        setCurrentScenario(0);
        setScenarioAnswer(null);
      };

      const handleScenarioAnswer = (optionId) => {
        setScenarioAnswer(optionId);
        const scenario = PRACTICE_SCENARIOS.research[currentScenario];
        const correct = scenario.options.find(o => o.id === optionId).correct;
        const newResults = { ...practiceResults, [scenario.id]: { correct, selectedAnswer: optionId } };
        setPracticeResults(newResults);
        bumpInteractions();
      };

      const handleNextScenario = () => {
        if (currentScenario < PRACTICE_SCENARIOS.research.length - 1) {
          setCurrentScenario(currentScenario + 1);
          setScenarioAnswer(null);
        } else {
          const correct = Object.values(practiceResults).filter(r => r.correct).length;
          const total = PRACTICE_SCENARIOS.research.length;
          const percentage = (correct / total) * 100;
          const mastery = calculateMastery(percentage);
          onComplete(mastery);
        }
      };

      const currentResearcher = researchers[activeTab];
      const rc = colorClasses[currentResearcher.color];

      return (
        <div className="space-y-8">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">Three Research Windows</h2>
            <p className="text-lg text-gray-700 mb-8">
              These three research programs converged on the same insight: agency is distributed
              and can be reprogrammed by writing to the right control layers.
            </p>

            {!showScenarios ? (
              <>
                <div className="flex border-b mb-6 overflow-x-auto">
                  {Object.entries(researchers).map(([key, researcher]) => {
                    const cc = colorClasses[researcher.color];
                    const isActive = activeTab === key;
                    return (
                      <button
                        key={key}
                        onClick={() => { setActiveTab(key); bumpInteractions(); }}
                        className={`flex items-center space-x-2 px-6 py-3 border-b-2 transition-all ${
                          isActive ? `${cc.border} ${cc.text} font-semibold` : 'border-transparent text-gray-600 hover:text-gray-900'
                        }`}
                      >
                        <span className="text-2xl">{researcher.icon}</span>
                        <span>{researcher.name.split(' & ')[0]}</span>
                      </button>
                    );
                  })}
                </div>

                <div className={`${rc.bg} border-l-4 ${rc.border} p-6 rounded mb-6`}>
                  <div className="flex items-start space-x-4">
                    <span className="text-5xl">{currentResearcher.icon}</span>
                    <div>
                      <h3 className="text-2xl font-bold text-gray-900">{currentResearcher.name}</h3>
                      <p className="text-gray-600">{currentResearcher.field}</p>
                      <div className="mt-3 p-3 bg-white rounded">
                        <p className="font-semibold text-gray-800">Key Insight:</p>
                        <p className="text-lg text-gray-700 italic">"{currentResearcher.keyInsight}"</p>
                      </div>
                    </div>
                  </div>
                </div>

                <div className="space-y-4 mb-8">
                  {currentResearcher.examples.map((example, index) => (
                    <div key={index} className="bg-gray-50 rounded-lg p-6">
                      <h4 className="text-xl font-bold text-gray-900 mb-2">{example.title}</h4>
                      <p className="text-gray-700 mb-3">{example.description}</p>
                      <div className="bg-white p-4 rounded border-l-4 border-purple-500">
                        <p className="font-semibold text-purple-900 mb-1">What This Teaches:</p>
                        <p className="text-gray-700">{example.lesson}</p>
                      </div>
                      <div className="mt-2 inline-block px-3 py-1 bg-purple-100 text-purple-800 text-sm rounded-full">
                        {example.level}
                      </div>
                    </div>
                  ))}
                </div>

                <div className="bg-gradient-to-br from-purple-100 to-purple-50 rounded-lg p-6 border-2 border-purple-200">
                  <h3 className="text-2xl font-bold text-purple-900 mb-4">Practice: Research Applications</h3>
                  <p className="text-gray-700 mb-4">
                    Test your understanding of the three research programs with {PRACTICE_SCENARIOS.research.length} application scenarios.
                  </p>
                  <button onClick={handleStartScenarios} className="px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                    Start Practice Scenarios ‚Üí
                  </button>
                </div>
              </>
            ) : (
              <div className="bg-white rounded-lg border-2 border-purple-200 p-6">
                <h3 className="text-2xl font-bold text-purple-900 mb-4">Scenario {currentScenario + 1} of {PRACTICE_SCENARIOS.research.length}</h3>
                {(() => {
                  const scenario = PRACTICE_SCENARIOS.research[currentScenario];
                  return (
                    <>
                      <p className="text-lg text-gray-800 mb-6 font-medium">{scenario.question}</p>
                      <div className="space-y-3 mb-6">
                        {scenario.options.map(option => {
                          const isSelected = scenarioAnswer === option.id;
                          const isCorrect = option.correct;
                          let cls = 'border-gray-300 hover:bg-gray-50';
                          if (scenarioAnswer !== null) {
                            if (isSelected && isCorrect) cls = 'border-green-500 bg-green-50';
                            else if (isSelected && !isCorrect) cls = 'border-red-500 bg-red-50';
                            else if (isCorrect) cls = 'border-green-500 bg-green-50';
                          }
                          return (
                            <button
                              key={option.id}
                              onClick={() => handleScenarioAnswer(option.id)}
                              disabled={scenarioAnswer !== null}
                              className={`w-full text-left p-4 rounded-lg border-2 transition-all ${cls}`}
                            >
                              <div className="flex items-start">
                                <span className="font-bold mr-3">{option.id}.</span>
                                <p className="flex-1 text-gray-800">{option.text}</p>
                              </div>
                            </button>
                          );
                        })}
                      </div>

                      {scenarioAnswer && (
                        <>
                          <div className={`p-4 rounded-lg mb-4 ${practiceResults[scenario.id]?.correct ? 'bg-green-50 border-l-4 border-green-500' : 'bg-red-50 border-l-4 border-red-500'}`}>
                            <p className="text-gray-700 text-sm">{scenario.explanation}</p>
                          </div>
                          <button onClick={handleNextScenario} className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                            {currentScenario < PRACTICE_SCENARIOS.research.length - 1 ? 'Next ‚Üí' : 'Complete ‚Üí'}
                          </button>
                        </>
                      )}
                    </>
                  );
                })()}
              </div>
            )}

            {showScenarios && Object.keys(practiceResults).length === PRACTICE_SCENARIOS.research.length && (
              <div className="mt-6">
                <button onClick={onNext} className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                  Continue to A-B-C-D Framework ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ---------------------------
    // ABCD Section (simplified)
    // ---------------------------
    function ABCDSection({ practiceResults, setPracticeResults, onComplete, onNext, updateProgress }) {
      const [expandedPrinciple, setExpandedPrinciple] = useState(null);

      const principles = [
        { id: 'agency', letter: 'A', title: 'Agency', subtitle: 'Distributed Across Scales', icon: 'üéØ',
          description: 'Agency is distributed across scales and can be enhanced or constrained by design.',
          designImplication: "Don't just fix agents‚Äîdesign contexts that unlock latent agency at every scale." },
        { id: 'beauty', letter: 'B', title: 'Beauty / Awe', subtitle: 'Salience Makes Control Layers Visible', icon: '‚ú®',
          description: 'Beauty and awe are functional mechanisms that drive attention and perseverance.',
          designImplication: 'Create interventions that are compelling and generate "aha!" moments.' },
        { id: 'context', letter: 'C', title: 'Context', subtitle: 'Conditions Gate Capabilities', icon: 'üåç',
          description: 'Context is designable infrastructure rather than fixed backdrop.',
          designImplication: 'Before changing agents, redesign the context.' },
        { id: 'dynamics', letter: 'D', title: 'Dynamics', subtitle: 'Feedbacks, Thresholds, Attractors', icon: 'üåÄ',
          description: 'Change happens through dynamic processes and threshold effects.',
          designImplication: 'Look for leverage points where brief interventions trigger lasting reorganization.' }
      ];

      const bumpInteractions = () => updateProgress(prev => ({ interactions: (prev?.interactions || 0) + 1 }));

      return (
        <div className="space-y-8">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">The A-B-C-D Framework</h2>
            <p className="text-lg text-gray-700 mb-8">Four principles that unify insights from all three research programs into a practical framework.</p>

            <div className="grid md:grid-cols-2 gap-6 mb-8">
              {principles.map(principle => (
                <div key={principle.id}>
                  <button
                    onClick={() => { setExpandedPrinciple(expandedPrinciple === principle.id ? null : principle.id); bumpInteractions(); }}
                    className={`w-full text-left p-6 rounded-lg border-2 transition-all ${
                      expandedPrinciple === principle.id ? 'border-purple-500 bg-purple-50' : 'border-gray-200 hover:border-gray-300'
                    }`}
                  >
                    <div className="flex items-start justify-between">
                      <div className="flex items-start space-x-4">
                        <span className="text-4xl">{principle.icon}</span>
                        <div>
                          <div className="flex items-center space-x-2 mb-1">
                            <span className="text-3xl font-bold text-purple-600">{principle.letter}</span>
                            <h3 className="text-2xl font-bold text-gray-900">{principle.title}</h3>
                          </div>
                          <p className="text-gray-600 italic">{principle.subtitle}</p>
                        </div>
                      </div>
                      <span className="text-gray-400">{expandedPrinciple === principle.id ? '‚ñº' : '‚ñ∂'}</span>
                    </div>
                  </button>

                  {expandedPrinciple === principle.id && (
                    <div className="mt-4 p-6 bg-gray-50 rounded-lg">
                      <p className="text-gray-700 mb-4">{principle.description}</p>
                      <div className="bg-purple-50 p-4 rounded border-l-4 border-purple-500">
                        <p className="font-semibold text-gray-900 mb-1">Design Implication:</p>
                        <p className="text-gray-700">{principle.designImplication}</p>
                      </div>
                    </div>
                  )}
                </div>
              ))}
            </div>

            <button
              onClick={() => { onComplete('proficient'); onNext(); }}
              className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors"
            >
              Continue to Integration ‚Üí
            </button>
          </div>
        </div>
      );
    }

    // ---------------------------
    // Integration Section
    // ---------------------------
    function IntegrationSection({ onComplete, onNext }) {
      const [response, setResponse] = useState('');
      const [submitted, setSubmitted] = useState(false);

      const handleSubmit = () => {
        if (response.length >= 100) { setSubmitted(true); onComplete('proficient'); }
      };

      return (
        <div className="space-y-6">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">Integration Exercise</h2>
            <p className="text-lg text-gray-700 mb-6">Apply everything you've learned to analyze a complex real-world case.</p>

            <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
              <h3 className="text-xl font-bold text-blue-900 mb-3">The Case</h3>
              <p className="text-gray-700 mb-4">
                A tech company has a comprehensive ethics policy and regular training, but employees
                continue to cut corners under deadline pressure. Investigation reveals: chronic understaffing,
                unrealistic deadlines set by executives, promotion based solely on speed (not quality),
                and a "move fast" culture that celebrates rule-breaking.
              </p>
            </div>

            {!submitted ? (
              <div>
                <h4 className="font-semibold text-gray-900 mb-3">Your Analysis:</h4>
                <p className="text-sm text-gray-600 mb-3">Address the following in your response (minimum 100 characters):</p>
                <ul className="list-disc list-inside text-sm text-gray-600 mb-4 space-y-1">
                  <li>What level(s) is the problem? (Capacity, capability, constructor, meta-constructor?)</li>
                  <li>Which researcher's insights are most relevant?</li>
                  <li>Which A-B-C-D principles apply?</li>
                  <li>What intervention approach would you recommend?</li>
                </ul>

                <textarea
                  className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent mb-2"
                  rows="10"
                  placeholder="Write your integrated analysis here..."
                  value={response}
                  onChange={(e) => setResponse(e.target.value)}
                ></textarea>
                <div className="flex justify-between items-center mb-4">
                  <span className="text-sm text-gray-600">{response.length} / 100 characters minimum</span>
                  <button
                    onClick={handleSubmit}
                    disabled={response.length < 100}
                    className={`px-6 py-2 rounded-lg font-semibold transition-colors ${
                      response.length >= 100 ? 'bg-purple-600 hover:bg-purple-700 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                    }`}
                  >
                    Submit Analysis
                  </button>
                </div>
              </div>
            ) : (
              <div>
                <div className="bg-green-50 border-l-4 border-green-500 p-6 mb-6">
                  <h4 className="font-semibold text-green-900 mb-2">‚úì Analysis Submitted</h4>
                  <p className="text-gray-700 mb-4">Here's your response:</p>
                  <div className="bg-white p-4 rounded border border-gray-200">
                    <p className="text-gray-700 whitespace-pre-wrap">{response}</p>
                  </div>
                </div>

                <div className="bg-blue-50 border-l-4 border-blue-500 p-6 mb-6">
                  <h4 className="font-semibold text-blue-900 mb-2">Expert Analysis</h4>
                  <div className="space-y-3 text-gray-700">
                    <p><strong>Primary Level:</strong> Capacity suppression (Context problem) from stress, deadlines, and incentives.</p>
                    <p><strong>Secondary Level:</strong> Constructor failure‚Äî‚Äúmove fast‚Äù culture undermines ethics norms.</p>
                    <p><strong>Relevant Research:</strong> Sapolsky‚Äîchronic stress & social rank; culture as constructor.</p>
                    <p><strong>A-B-C-D:</strong> Context (C) primary; Dynamics (D) feedback loop: rewarded corner-cutting ‚Üí normalization ‚Üí culture.</p>
                    <p><strong>Intervention:</strong> Context redesign (workload, incentives) ‚Üí constructor work (norms, rituals).</p>
                  </div>
                </div>

                <button onClick={onNext} className="w-full px-6 py-3 bg-purple-600 hover:bg-purple-700 text-white rounded-lg font-semibold transition-colors">
                  Continue to Final Assessment ‚Üí
                </button>
              </div>
            )}
          </div>
        </div>
      );
    }

    // ---------------------------
    // Assessment Section
    // ---------------------------
    function AssessmentSection({ quizResults, setQuizResults, onComplete, studentInfo, sessionData, sectionProgress, practiceResults }) {
      const [answers, setAnswers] = useState({});
      const [showResults, setShowResults] = useState(false);

      const questions = [
        {
          id: 'q1',
          question: 'Healthcare workers showing reduced compassion due to chronic understaffing and impossible workloads is primarily:',
          options: [
            { id: 'A', text: 'Capability gap', correct: false },
            { id: 'B', text: 'Capacity suppression', correct: true },
            { id: 'C', text: 'Constructor failure', correct: false },
            { id: 'D', text: 'Meta-constructor issue', correct: false }
          ],
          explanation: 'Correct: B. Capacity suppression from stress; fix context first.'
        },
        {
          id: 'q2',
          question: 'Levin showed that bioelectric patterns can induce eyes in non-eye tissue. This demonstrates:',
          options: [
            { id: 'A', text: 'Genetic changes are required', correct: false },
            { id: 'B', text: 'Context can unlock latent capacities', correct: true },
            { id: 'C', text: 'Random developmental outcomes', correct: false },
            { id: 'D', text: 'DNA determines all structures', correct: false }
          ],
          explanation: 'Correct: B. Same genome, different bioelectric context, different outcomes.'
        },
        {
          id: 'q3',
          question: 'In the A-B-C-D framework, Beauty/Awe (B) is important because it:',
          options: [
            { id: 'A', text: 'Is purely aesthetic', correct: false },
            { id: 'B', text: 'Makes control layers visible and creates future pull', correct: true },
            { id: 'C', text: 'Only matters in art', correct: false },
            { id: 'D', text: 'Distracts from practical work', correct: false }
          ],
          explanation: 'Correct: B. Beauty/Awe directs attention and motivation.'
        },
        {
          id: 'q4',
          question: 'The relationship between capacity and capability is:',
          options: [
            { id: 'A', text: 'They are the same', correct: false },
            { id: 'B', text: 'Capability is latent, capacity is expressed', correct: false },
            { id: 'C', text: 'Capacity is latent potential, capability is reliable function', correct: true },
            { id: 'D', text: 'Capabilities come first', correct: false }
          ],
          explanation: 'Correct: C. Context design unlocks capacities into capabilities.'
        }
      ];

      const handleSubmit = () => {
        const correct = questions.filter(q => answers[q.id] === q.options.find(o => o.correct).id).length;
        const percentage = Math.round((correct / questions.length) * 100);
        const results = { answers, correct, total: questions.length, percentage };
        setShowResults(true);
        onComplete(results);
      };

      const allAnswered = questions.every(q => answers[q.id]);

      if (showResults && quizResults) {
        return (
          <CompletionDocument
            studentInfo={studentInfo}
            sessionData={sessionData}
            sectionProgress={sectionProgress}
            practiceResults={practiceResults}
            quizResults={quizResults}
          />
        );
      }

      return (
        <div className="space-y-8">
          <div className="bg-white rounded-lg shadow-lg p-8">
            <h2 className="text-3xl font-bold text-gray-900 mb-4">Final Assessment</h2>
            <p className="text-lg text-gray-700 mb-8">Complete this assessment to demonstrate your understanding of the framework.</p>

            <div className="space-y-6">
              {questions.map((q, index) => {
                const userAnswer = answers[q.id];
                return (
                  <div key={q.id} className="border-2 border-gray-200 rounded-lg p-6">
                    <h3 className="text-lg font-semibold text-gray-900 mb-4">Question {index + 1}: {q.question}</h3>
                    <div className="space-y-3">
                      {q.options.map(option => (
                        <button
                          key={option.id}
                          onClick={() => setAnswers({ ...answers, [q.id]: option.id })}
                          disabled={showResults}
                          className={`w-full text-left p-4 rounded-lg border-2 transition-all ${
                            userAnswer === option.id ? 'border-purple-500 bg-purple-50' : 'border-gray-300 hover:bg-gray-50'
                          }`}
                        >
                          <div className="flex items-start">
                            <span className="font-bold mr-3">{option.id}.</span>
                            <span className="flex-1">{option.text}</span>
                          </div>
                        </button>
                      ))}
                    </div>
                  </div>
                );
              })}
            </div>

            <button
              onClick={handleSubmit}
              disabled={!allAnswered}
              className={`mt-8 w-full px-6 py-3 rounded-lg font-semibold transition-colors ${
                allAnswered ? 'bg-purple-600 hover:bg-purple-700 text-white' : 'bg-gray-300 text-gray-500 cursor-not-allowed'
              }`}
            >
              {allAnswered ? 'Submit Assessment ‚Üí' : 'Answer all questions to submit'}
            </button>
          </div>
        </div>
      );
    }

    // ---------------------------
    // Completion Document
    // ---------------------------
    function CompletionDocument({ studentInfo, sessionData, sectionProgress, practiceResults, quizResults }) {
      const generateDocument = () => {
        const calculateTime = (section) => {
          if (!section.startTime || !section.endTime) return 0;
          return Math.round((new Date(section.endTime) - new Date(section.startTime)) / 60000);
        };

        const totalTime = Object.values(sectionProgress).reduce((sum, section) => sum + calculateTime(section), 0);
        const levelsPractice = Object.values(practiceResults.levels || {});
        const researchPractice = Object.values(practiceResults.research || {});
        const abcdPractice = Object.values(practiceResults.abcd || {});
        const levelsCorrect = levelsPractice.filter(r => r.correct).length;
        const researchCorrect = researchPractice.filter(r => r.correct).length;
        const abcdCorrect = abcdPractice.filter(r => r.correct).length;
        const overallScore = quizResults.percentage;
        const passed = overallScore >= 75;

        const sectionBlock = Object.entries(sectionProgress).map(([id, section]) => `
${id.toUpperCase()}:
  Status: ${getMasteryLabel(section.status)}
  Time Spent: ${calculateTime(section)} minutes
  ${section.interactions ? `Interactions: ${section.interactions}` : ''}`).join('\n');

        return `‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
MODULE 1: FRAMEWORK FOUNDATIONS
Completion Document
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

STUDENT INFORMATION:
  Name:           ${studentInfo.name}
  Email:          ${studentInfo.email}
  Course:         ${studentInfo.course}

COMPLETION VERIFICATION:
  Session ID:     ${sessionData.sessionId}
  Started:        ${new Date(sessionData.startTime).toLocaleString()}
  Completed:      ${new Date(sessionData.completionTime).toLocaleString()}
  Total Time:     ${totalTime} minutes
  Status:         ${passed ? '‚úì PASSED' : '‚úó NEEDS REVIEW'} (${overallScore}%)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
PERFORMANCE SUMMARY
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

Overall Mastery Level: ${overallScore >= 90 ? '‚≠ê MASTERED' : overallScore >= 80 ? '‚úì PROFICIENT' : overallScore >= 60 ? 'üîÑ DEVELOPING' : '‚≠ï NOVICE'}

Final Assessment: ${quizResults.correct}/${quizResults.total} correct (${overallScore}%)
Required Threshold: 75%

Practice Performance:
  Level Identification:    ${levelsCorrect}/${levelsPractice.length} (${levelsPractice.length > 0 ? Math.round((levelsCorrect/levelsPractice.length)*100) : 0}%)
  Research Applications:   ${researchCorrect}/${researchPractice.length} (${researchPractice.length > 0 ? Math.round((researchCorrect/researchPractice.length)*100) : 0}%)
  A-B-C-D Integration:     ${abcdCorrect}/${abcdPractice.length} (${abcdPractice.length > 0 ? Math.round((abcdCorrect/abcdPractice.length)*100) : 0}%)

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
SECTION BREAKDOWN
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${sectionBlock}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
LEARNING OBJECTIVES ACHIEVED
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

‚úì Understanding the Four-Level Diagnostic Model
‚úì Research Foundations (Levin, Sapolsky, Graeber & Wengrow)
‚úì A-B-C-D Framework (Agency, Beauty/Awe, Context, Dynamics)
‚úì Integration & Application

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
NEXT STEPS
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
${passed ? `‚úì Ready for Module 2: Diagnostic Practice` : `‚ö†Ô∏è Review Recommended`}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
VERIFICATION
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
This document was auto-generated and cannot be modified.
Session ID: ${sessionData.sessionId}
Generated: ${new Date().toLocaleString()}

For Instructor Use:
  Student Status: ${passed ? 'PASSED' : 'INCOMPLETE'}
  Ready for Module 2: ${passed ? 'YES' : 'NO'}
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
`;
      };

      const downloadDocument = () => {
        const doc = generateDocument();
        const blob = new Blob([doc], { type: 'text/plain' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `Module1-Completion-${(studentInfo.name || 'Student').replace(/\s+/g, '_')}.txt`;
        a.click();
      };

      const copyToClipboard = () => {
        const doc = generateDocument();
        navigator.clipboard.writeText(doc);
        alert('Completion document copied to clipboard!');
      };

      const passed = quizResults.percentage >= 75;

      return (
        <div className="space-y-6">
          <div className={`bg-white rounded-lg shadow-lg p-8 border-2 ${passed ? 'border-green-500' : 'border-yellow-500'}`}>
            <div className="text-center mb-8">
              <div className="text-6xl mb-4">{passed ? 'üéâ' : 'üìö'}</div>
              <h2 className="text-4xl font-bold text-gray-900 mb-2">
                {passed ? 'Congratulations!' : 'Assessment Complete'}
              </h2>
              <p className="text-xl text-gray-700">
                {passed ? "You've successfully completed Module 1!" : "Please review and try again to achieve 75%"}
              </p>
              <div className="text-5xl font-bold text-purple-700 mt-4">{quizResults.percentage}%</div>
            </div>

            <div className="grid md:grid-cols-3 gap-4 mb-8">
              <div className="bg-purple-50 p-4 rounded-lg text-center">
                <div className="text-sm text-gray-600">Final Assessment</div>
                <div className="text-2xl font-bold text-gray-900">{quizResults.correct}/{quizResults.total}</div>
              </div>
              <div className="bg-blue-50 p-4 rounded-lg text-center">
                <div className="text-sm text-gray-600">Time Invested</div>
                <div className="text-2xl font-bold text-gray-900">
                  {Object.values(sectionProgress).reduce((sum, s) => {
                    if (!s.startTime || !s.endTime) return sum;
                    return sum + Math.round((new Date(s.endTime) - new Date(s.startTime)) / 60000);
                  }, 0)} min
                </div>
              </div>
              <div className="bg-green-50 p-4 rounded-lg text-center">
                <div className="text-sm text-gray-600">Status</div>
                <div className="text-lg font-bold text-gray-900">{getMasteryLabel(calculateMastery(quizResults.percentage))}</div>
              </div>
            </div>

            <div className="bg-gray-50 p-6 rounded-lg mb-6">
              <h3 className="font-semibold text-gray-900 mb-3">Your Completion Document Includes:</h3>
              <ul className="space-y-2 text-gray-700">
                <li>‚úì Complete performance summary with verification</li>
                <li>‚úì Section-by-section breakdown with time tracking</li>
                <li>‚úì Practice exercise results across all topics</li>
                <li>‚úì Learning objectives achieved</li>
                <li>‚úì Personalized recommendations for next steps</li>
              </ul>
            </div>

            <div className="space-y-3">
              <button onClick={downloadDocument} className="w-full bg-purple-600 text-white py-3 px-6 rounded-lg font-semibold hover:bg-purple-700 transition-colors flex items-center justify-center">
                <span className="mr-2">üìÑ</span> Download Completion Document
              </button>
              <button onClick={copyToClipboard} className="w-full bg-gray-200 text-gray-700 py-3 px-6 rounded-lg font-semibold hover:bg-gray-300 transition-colors flex items-center justify-center">
                <span className="mr-2">üìã</span> Copy to Clipboard
              </button>
            </div>
          </div>

          {!passed && (
            <div className="bg-yellow-50 border-l-4 border-yellow-500 p-6 rounded-lg">
              <h3 className="font-semibold text-yellow-900 mb-2">What to Do Next</h3>
              <p className="text-gray-700 mb-4">
                You scored {quizResults.percentage}% but need 75% to proceed. We recommend:
              </p>
              <ul className="space-y-2 text-gray-700">
                <li>‚Ä¢ Review the Four Levels section with practice scenarios</li>
                <li>‚Ä¢ Study the Research Examples and their applications</li>
                <li>‚Ä¢ Focus on A-B-C-D framework integration</li>
                <li>‚Ä¢ When ready, start a new session and try again</li>
              </ul>
            </div>
          )}
        </div>
      );
    }

    // ---------------------------
    // Mount React 18
    // ---------------------------
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
